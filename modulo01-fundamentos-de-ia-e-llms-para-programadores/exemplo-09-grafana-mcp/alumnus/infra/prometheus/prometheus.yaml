global:
  scrape_interval:     5s
  evaluation_interval: 5s

# Alerting configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: []
          # - alertmanager:9093  # Uncomment when Alertmanager is added

# Load alerting rules
rule_files:
  - /etc/prometheus/alerts.yaml

scrape_configs:
  - job_name: 'otel-collector-metrics'
    static_configs:
      - targets: ['opentelemetry-collector:8889']

  - job_name: 'tempo'
    static_configs:
      - targets: [ 'tempo:3200' ]

  - job_name: 'grafana'
    static_configs:
      - targets: [ 'grafana:3000' ]

  - job_name: 'loki'
    static_configs:
      - targets: [ 'loki:3100' ]

  - job_name: 'blackbox'
    static_configs:
      - targets: [ 'blackbox:9115' ]

  # Blackbox monitoring for HTTP services
  - job_name: 'blackbox-http'
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
        - http://grafana:3000/api/health
        - http://prometheus:9090/-/healthy
        - http://loki:3100/ready
        - http://tempo:3200/ready
        - http://opentelemetry-collector:13133/  # OTEL Collector health
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115

  # Blackbox monitoring for TCP services (databases, cache, message queue)
  - job_name: 'blackbox-tcp'
    metrics_path: /probe
    params:
      module: [tcp_connect]
    static_configs:
      - targets:
        - alumnus-postgres:5432  # PostgreSQL
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115

  # Blackbox monitoring for ICMP (ping) checks
  - job_name: 'blackbox-icmp'
    metrics_path: /probe
    params:
      module: [icmp_ping]
    static_configs:
      - targets:
        - alumnus-postgres
        - grafana
        - prometheus
        - loki
        - tempo

        - opentelemetry-collector
        - blackbox
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115
storage:
  tsdb:
    out_of_order_time_window: 30m
